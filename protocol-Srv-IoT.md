# Exchanges protocol between the tracker and the server throught MQTT
| **_Goal of communication_**                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | **_Frame_**                                     | **_MQTT topic used_** | **_Send by_** |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|-----------------------|---------------|
| **ESTABLISHING A CONNECTION**                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                 |                       |               |
| Initialize connection with Srv (Begin Hand Check)                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `SYN`                                           | TX                    | Tracker       |
| Confirm connection to tracker (Acknowledge Hand Check)                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `SYN-ACK`                                       | RX                    | Server        |
| Confirm connection is established (Connection established)                                                                                                                                                                                                                                                                                                                                                                                                                                              | `ACK`                                           | TX                    | Tracker       |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                 |                       |               |
| **TRACKER STATUS**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                 |                       |               |
| Request status from the tracker                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `STS-RQ`                                        | RX                    | Server        |
| Sending status to the server (The tracker can send its status without the server asking for it)<br><br>"bat" = battery charge level (in %)<br>"charge" = boolean --> true (1) if the tracker charging on the vehicle battery, otherwise false (0)<br>"protection" = boolean --> true (1) if protection is active, otherwise false (0)<br>"alarm" = boolean --> true (1) if alarm is ringing, otherwise false (0)<br>"gps" = boolean --> true (1) if the tracker can get it position, otherwise false(0) | `STS="bat","charge","protection","alarm","gps"` | TX                    | Tracker       |
| Acknowledge reception of status                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `STS-ACK`                                       | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                 |                       |               |
| **PINGING**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                 |                       |               |
| Server ping tracker                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `PING`                                          | RX                    | Server        |
| Tracker pong to server                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `PONG`                                          | TX                    | Tracker       |
| Tracker ping server                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `PING`                                          | TX                    | Tracker       |
| Server pong to tracker                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `PONG`                                          | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                 |                       |               |
| **TRACKER POSITION**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                 |                       |               |
| Server request tracker position                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `POS-RQ`                                        | RX                    | Server        |
| Tracker send it position (The tracker can send its status without the server asking for it)<br><br>"lon" = longitude<br>"lat" = latitude                                                                                                                                                                                                                                                                                                                                                                | `POS="lon","lat"`                               | TX                    | Tracker       |
| If tracker cannot send it position                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `POS-RQ`                                        | TX                    | Tracker       |
| Server acknowledge reception of position                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `POS-ACK`                                       | RX                    | Server        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                 |                       |               |
| **TRACKER PROTECTION**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                 |                       |               |
| Server (des)active the protection<br><br>"state" = true (1) if alarm must ring, otherwise false (0)                                                                                                                                                                                                                                                                                                                                                                                                     | `PRT="state"`                                   | RX                    | Server        |
| Tracker acknowledge protection value changed                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `PRT-ACK`                                       | TX                    | Tracker       |

> Please open an issue if we forget to register/documentate a frame !
